<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>陈荔闽 - R plotting Scripts</title>
  <meta name="viewport" content="width=device-width">
  <!-- syntax highlighting CSS -->
  <link rel="stylesheet" href="/css/syntax.css">
  <!-- Custom CSS -->
  <link rel="stylesheet" href="/css/main.css">
  <!-- Responsive CSS -->
  <link rel="stylesheet" href="/css/responsive.css">
  <!-- Google Fonts -->
  <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Raleway:300,400,700' rel='stylesheet' type='text/css'>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
</head>

  <body>
    <div class="site">
      <div class="sidebar" id="sidebar">
  <div class="header">
    <h1 class="title"><a href="/"><img id="logo" src="/images/logo.png"></a></h1>
    <span class="tagline">荔闽的博客</span>
  </div>
  <div class="posts">
    <div class="tag-cloud">
  
  <a href="/tag/心情" id="1" class="__tag" style="margin: 5px">心情</a>
  
  <a href="/tag/总结" id="2" class="__tag" style="margin: 5px">总结</a>
  
</div>

<div id ="posts-tags" class="post-list"></div>

<script type="text/javascript">
   $(function() {
      var minFont = 15.0,
          maxFont = 40.0,
          diffFont = maxFont - minFont,
          size = 0;
       
      
      
         
            
         
      
         
      
            
      
         size = (Math.log(2) / Math.log(2)) * diffFont + minFont;
         $("#1").css("font-size", size + "px");
      
         size = (Math.log(1) / Math.log(2)) * diffFont + minFont;
         $("#2").css("font-size", size + "px");
      

      $('.tag-cloud a[class^="__tag"]').click(function() {
         $('.post-list').empty();
         $('#list_' + $(this).attr('id')).each(function() {
            $('.post-list').append('<ul>' + $(this).html() + '</ul>');
         });
      });
   });
    
</script>

  </div>
  <div class="footer">
  <span id="footer-links">
    <a href="http://weibo.com/u/1932223517" class="footer-link">微博</a> <span class="separator">&bull;</span>
    <a href="http://www.renren.com/253445776/profile" class="footer-link">人人</a> <span class="separator">&bull;</span>
    <a href="http://www.douban.com/people/45660356/" class="footer-link">豆瓣</a> <span class="separator">&bull;</span>
    <a href="https://www.facebook.com/elainechenlm" class="footer-link">Facebook</a> 
  </span>
</div>

</div>

      <div class="content" id="home">
  <div id="sidebar-button">
    <img src="/images/sidebar-button.png">
  </div>
  <div id="post-info">
    <div id="cover-photo-container">
      <img id="cover-photo" src="/images/wide_cover.jpg">
    </div>
    <div id="info-container">
      <h1 id="title">R plotting Scripts</h1>
      <span id="date">2014-05-22</a>
    </div>
  </div>

  <div class="post">
    <h2>R plotting Scripts</h2>

<p><em>写这篇博客目的只是为了帮助更多的文科生开始学习使用一些R的程序进行声调测量，内容大多是对于程序编写的说明，原R代码以及数据sample上传至dropbox。如果有任何疑问和错误，大家可以指出，共同维护这个博客的继续运行。多谢诸位！^_^</em></p>

<p><em>感谢Zhang Ben在程序编写和统计知识上对于我的引导和帮助，希望大家尊重劳动成果，引用时需要注明出处。</em></p>

<h3>1. Line Plotting</h3>

<p>一般画声调的曲线是会采用Line Plotting，以下介绍最为简单的部分，其他多图，复杂部分均为在此基础上的修改。</p>

<h4>数据的格式要求：</h4>

<style>
<!--table
    {mso-displayed-decimal-separator:"\.";
    mso-displayed-thousand-separator:"\,";}
@page
    {margin:1.0in .75in 1.0in .75in;
    mso-header-margin:.5in;
    mso-footer-margin:.5in;}
.style0
    {mso-number-format:General;
    text-align:general;
    vertical-align:bottom;
    white-space:nowrap;
    mso-rotate:0;
    mso-background-source:auto;
    mso-pattern:auto;
    color:black;
    font-size:12.0pt;
    font-weight:400;
    font-style:normal;
    text-decoration:none;
    font-family:Calibri, sans-serif;
    mso-font-charset:0;
    border:none;
    mso-protection:locked visible;
    mso-style-name:Normal;
    mso-style-id:0;}
td
    {mso-style-parent:style0;
    padding-top:1px;
    padding-right:1px;
    padding-left:1px;
    mso-ignore:padding;
    color:black;
    font-size:12.0pt;
    font-weight:400;
    font-style:normal;
    text-decoration:none;
    font-family:Calibri, sans-serif;
    mso-font-charset:0;
    mso-number-format:General;
    text-align:general;
    vertical-align:bottom;
    border:none;
    mso-background-source:auto;
    mso-pattern:auto;
    mso-protection:locked visible;
    white-space:nowrap;
    mso-rotate:0;}
.xl65
    {mso-style-parent:style0;
    text-align:center;
    border:.5pt solid windowtext;}
-->
</style>

<table border=0 cellpadding=0 cellspacing=0 width=423 style='border-collapse:
 collapse;table-layout:fixed;width:423pt'>
 <col width=38 style='mso-width-source:userset;mso-width-alt:1621;width:38pt'>
 <col width=35 span=11 style='mso-width-source:userset;mso-width-alt:1493;
 width:35pt'>
 <tr height=15 style='height:15.0pt'>
  <td height=15 class=xl65 width=38 style='height:15.0pt;width:38pt'>1a</td>
  <td class=xl65 width=35 style='border-left:none;width:35pt'>1.5</td>
  <td class=xl65 width=35 style='border-left:none;width:35pt'>1.38</td>
  <td class=xl65 width=35 style='border-left:none;width:35pt'>1.18</td>
  <td class=xl65 width=35 style='border-left:none;width:35pt'>0.95</td>
  <td class=xl65 width=35 style='border-left:none;width:35pt'>0.73</td>
  <td class=xl65 width=35 style='border-left:none;width:35pt'>0.52</td>
  <td class=xl65 width=35 style='border-left:none;width:35pt'>0.32</td>
  <td class=xl65 width=35 style='border-left:none;width:35pt'>0.14</td>
  <td class=xl65 width=35 style='border-left:none;width:35pt'>0</td>
  <td class=xl65 width=35 style='border-left:none;width:35pt'>-0.12</td>
  <td class=xl65 width=35 style='border-left:none;width:35pt'>-0.19</td>
 </tr>
 <tr height=15 style='height:15.0pt'>
  <td height=15 class=xl65 style='height:15.0pt;border-top:none'>1b</td>
  <td class=xl65 style='border-top:none;border-left:none'>-0.42</td>
  <td class=xl65 style='border-top:none;border-left:none'>-0.45</td>
  <td class=xl65 style='border-top:none;border-left:none'>-0.42</td>
  <td class=xl65 style='border-top:none;border-left:none'>-0.37</td>
  <td class=xl65 style='border-top:none;border-left:none'>-0.29</td>
  <td class=xl65 style='border-top:none;border-left:none'>-0.2</td>
  <td class=xl65 style='border-top:none;border-left:none'>-0.07</td>
  <td class=xl65 style='border-top:none;border-left:none'>0.1</td>
  <td class=xl65 style='border-top:none;border-left:none'>0.35</td>
  <td class=xl65 style='border-top:none;border-left:none'>0.63</td>
  <td class=xl65 style='border-top:none;border-left:none'>0.88</td>
 </tr>
 <tr height=15 style='height:15.0pt'>
  <td height=15 class=xl65 style='height:15.0pt;border-top:none'>2ab</td>
  <td class=xl65 style='border-top:none;border-left:none'>0.29</td>
  <td class=xl65 style='border-top:none;border-left:none'>0.36</td>
  <td class=xl65 style='border-top:none;border-left:none'>0.45</td>
  <td class=xl65 style='border-top:none;border-left:none'>0.51</td>
  <td class=xl65 style='border-top:none;border-left:none'>0.51</td>
  <td class=xl65 style='border-top:none;border-left:none'>0.45</td>
  <td class=xl65 style='border-top:none;border-left:none'>0.33</td>
  <td class=xl65 style='border-top:none;border-left:none'>0.13</td>
  <td class=xl65 style='border-top:none;border-left:none'>-0.18</td>
  <td class=xl65 style='border-top:none;border-left:none'>-0.57</td>
  <td class=xl65 style='border-top:none;border-left:none'>-1.04</td>
 </tr>
 <tr height=15 style='height:15.0pt'>
  <td height=15 class=xl65 style='height:15.0pt;border-top:none'>3a</td>
  <td class=xl65 style='border-top:none;border-left:none'>2.31</td>
  <td class=xl65 style='border-top:none;border-left:none'>2.25</td>
  <td class=xl65 style='border-top:none;border-left:none'>2.09</td>
  <td class=xl65 style='border-top:none;border-left:none'>1.84</td>
  <td class=xl65 style='border-top:none;border-left:none'>1.48</td>
  <td class=xl65 style='border-top:none;border-left:none'>1.07</td>
  <td class=xl65 style='border-top:none;border-left:none'>0.62</td>
  <td class=xl65 style='border-top:none;border-left:none'>0.16</td>
  <td class=xl65 style='border-top:none;border-left:none'>-0.31</td>
  <td class=xl65 style='border-top:none;border-left:none'>-0.75</td>
  <td class=xl65 style='border-top:none;border-left:none'>-1.2</td>
 </tr>
 <tr height=15 style='height:15.0pt'>
  <td height=15 class=xl65 style='height:15.0pt;border-top:none'>3b</td>
  <td class=xl65 style='border-top:none;border-left:none'>-0.14</td>
  <td class=xl65 style='border-top:none;border-left:none'>-0.21</td>
  <td class=xl65 style='border-top:none;border-left:none'>-0.38</td>
  <td class=xl65 style='border-top:none;border-left:none'>-0.61</td>
  <td class=xl65 style='border-top:none;border-left:none'>-0.88</td>
  <td class=xl65 style='border-top:none;border-left:none'>-1.17</td>
  <td class=xl65 style='border-top:none;border-left:none'>-1.47</td>
  <td class=xl65 style='border-top:none;border-left:none'>-1.77</td>
  <td class=xl65 style='border-top:none;border-left:none'>-2.07</td>
  <td class=xl65 style='border-top:none;border-left:none'>-2.37</td>
  <td class=xl65 style='border-top:none;border-left:none'>-2.68</td>
 </tr>
 <tr height=15 style='height:15.0pt'>
  <td height=15 class=xl65 style='height:15.0pt;border-top:none'>1a</td>
  <td class=xl65 style='border-top:none;border-left:none'>0</td>
  <td class=xl65 style='border-top:none;border-left:none'>0.13</td>
  <td class=xl65 style='border-top:none;border-left:none'>0.27</td>
  <td class=xl65 style='border-top:none;border-left:none'>0.4</td>
  <td class=xl65 style='border-top:none;border-left:none'>0.54</td>
  <td class=xl65 style='border-top:none;border-left:none'>0.67</td>
  <td class=xl65 style='border-top:none;border-left:none'>0.81</td>
  <td class=xl65 style='border-top:none;border-left:none'>0.94</td>
  <td class=xl65 style='border-top:none;border-left:none'>1.08</td>
  <td class=xl65 style='border-top:none;border-left:none'>1.21</td>
  <td class=xl65 style='border-top:none;border-left:none'>1.35</td>
 </tr>
 <tr height=15 style='height:15.0pt'>
  <td height=15 class=xl65 style='height:15.0pt;border-top:none'>1b</td>
  <td class=xl65 style='border-top:none;border-left:none'>0</td>
  <td class=xl65 style='border-top:none;border-left:none'>0.14</td>
  <td class=xl65 style='border-top:none;border-left:none'>0.28</td>
  <td class=xl65 style='border-top:none;border-left:none'>0.41</td>
  <td class=xl65 style='border-top:none;border-left:none'>0.55</td>
  <td class=xl65 style='border-top:none;border-left:none'>0.69</td>
  <td class=xl65 style='border-top:none;border-left:none'>0.83</td>
  <td class=xl65 style='border-top:none;border-left:none'>0.96</td>
  <td class=xl65 style='border-top:none;border-left:none'>1.1</td>
  <td class=xl65 style='border-top:none;border-left:none'>1.24</td>
  <td class=xl65 style='border-top:none;border-left:none'>1.38</td>
 </tr>
 <tr height=15 style='height:15.0pt'>
  <td height=15 class=xl65 style='height:15.0pt;border-top:none'>2ab</td>
  <td class=xl65 style='border-top:none;border-left:none'>0</td>
  <td class=xl65 style='border-top:none;border-left:none'>0.12</td>
  <td class=xl65 style='border-top:none;border-left:none'>0.23</td>
  <td class=xl65 style='border-top:none;border-left:none'>0.35</td>
  <td class=xl65 style='border-top:none;border-left:none'>0.46</td>
  <td class=xl65 style='border-top:none;border-left:none'>0.58</td>
  <td class=xl65 style='border-top:none;border-left:none'>0.7</td>
  <td class=xl65 style='border-top:none;border-left:none'>0.81</td>
  <td class=xl65 style='border-top:none;border-left:none'>0.93</td>
  <td class=xl65 style='border-top:none;border-left:none'>1.04</td>
  <td class=xl65 style='border-top:none;border-left:none'>1.16</td>
 </tr>
 <tr height=15 style='height:15.0pt'>
  <td height=15 class=xl65 style='height:15.0pt;border-top:none'>3a</td>
  <td class=xl65 style='border-top:none;border-left:none'>0</td>
  <td class=xl65 style='border-top:none;border-left:none'>0.08</td>
  <td class=xl65 style='border-top:none;border-left:none'>0.16</td>
  <td class=xl65 style='border-top:none;border-left:none'>0.24</td>
  <td class=xl65 style='border-top:none;border-left:none'>0.32</td>
  <td class=xl65 style='border-top:none;border-left:none'>0.4</td>
  <td class=xl65 style='border-top:none;border-left:none'>0.47</td>
  <td class=xl65 style='border-top:none;border-left:none'>0.55</td>
  <td class=xl65 style='border-top:none;border-left:none'>0.63</td>
  <td class=xl65 style='border-top:none;border-left:none'>0.71</td>
  <td class=xl65 style='border-top:none;border-left:none'>0.79</td>
 </tr>
 <tr height=15 style='height:15.0pt'>
  <td height=15 class=xl65 style='height:15.0pt;border-top:none'>3b</td>
  <td class=xl65 style='border-top:none;border-left:none'>0</td>
  <td class=xl65 style='border-top:none;border-left:none'>0.11</td>
  <td class=xl65 style='border-top:none;border-left:none'>0.23</td>
  <td class=xl65 style='border-top:none;border-left:none'>0.34</td>
  <td class=xl65 style='border-top:none;border-left:none'>0.45</td>
  <td class=xl65 style='border-top:none;border-left:none'>0.57</td>
  <td class=xl65 style='border-top:none;border-left:none'>0.68</td>
  <td class=xl65 style='border-top:none;border-left:none'>0.79</td>
  <td class=xl65 style='border-top:none;border-left:none'>0.91</td>
  <td class=xl65 style='border-top:none;border-left:none'>1.02</td>
  <td class=xl65 style='border-top:none;border-left:none'>1.13</td>
 </tr>
</table>

<p><strong>需要注意的地方有两点：</strong></p>

<p><em>此处还是请参加照dropbox中文件的样式，有bug，暂时还没debug。</em></p>

<p>1.表格第一列第一行空格中为Title，可以修改，例如画发音人T1，可将“Tone system”修改为“Speaker T1”.</p>

<p>2.一定要保持声调列一一对应。上面为pitch值或归一化后的pitch值，下面为时长或归一化后的时长。 </p>

<hr>

<h4>现在是R script 部分：</h4>

<p>** 用紫色区块标出来的均为代码部分。**</p>

<p>首先，要现在R里导入我们读取数据、调整数据、以及画图的库。</p>

<p><code>library(xlsx)</code>
read the data from excel file .xlsx</p>

<p><code>library(reshape)</code>
melt the data</p>

<p><code>library(ggplot2)</code>
plotting the pitch contour</p>

<p><code>data &lt;- read.xlsx(&quot;test.xlsx&quot;, sheetIndex = 1, encoding = &quot;UTF-8&quot;, header = F)</code> Read data from excel </p>

<p><code>title &lt;- toString(data[1,1])</code> 命名标题</p>

<p><code>data$X1 &lt;- NULL</code> 将第一列的值定义为空。</p>

<p><code>separateLine &lt;- which(data$X2 == data$X2[1])[2]</code> 寻找pitch值和duration值的分界行。</p>

<p><code>ydata &lt;- melt(data[1:(separateLine-1),],  id = c(&quot;X2&quot;))</code> 将pitch部分data读取，定义为ydata</p>

<p><code>xdata &lt;- melt(data[separateLine:nrow(data),],  id = c(&quot;X2&quot;))</code>将duration部分的data读取，义为xdata</p>

<p><code>alldata &lt;- cbind(xdata, ydata)</code>合并两个data</p>

<p><code>colnames(alldata) &lt;- c(&quot;tone&quot;, &quot;&quot;, &quot;x&quot;, &quot;&quot;, &quot;&quot;, &quot;y&quot;)</code> 对列进行命名</p>

<p><code>f1 &lt;- ggplot(alldata, aes(x = x, y = y, colour = tone, shape = tone)) +</code>
       读取数值，画图。</p>

<p><code>geom_line(size=1.2) +</code>控制线的宽度</p>

<p><code>geom_point(size=3) +</code>控制点的大小</p>

<p><code>theme_bw() +</code> 
   默认背景为灰色，这行可换成白底</p>

<p><code>scale_shape_manual(values=1:11) +</code></p>

<p><code>xlab(&quot;Duration(ms)&quot;)+</code>
   对X轴命名</p>

<p><code>ylab(&quot;Log z-score F0(Hz)&quot;)+</code>
   对y轴命名</p>

<p><code>ggtitle(paste(&quot;Puxian Min&quot;, title))</code>
   整个图片命名</p>

<hr>

<h4>根据上面出来的效果图：</h4>

<p><img src="/images/plot.png" alt="Alt text"></p>

  </div>
  
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'limin'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
  
  
  <div class="colophon">
    <p>
      <span id="pub-date">发表于 2014-05-22</span> 
    </p>
  </div>
</div>


    </div>
    <script src="/scripts/responsive.js" type="text/javascript"></script>
  </body>
</html>
